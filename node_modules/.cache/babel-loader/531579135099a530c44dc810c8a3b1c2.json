{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encodeParams = encodeParams;\nexports.encodeUri = encodeUri;\nexports.map = map;\nexports.filter = filter;\nexports.keys = keys;\nexports.values = values;\nexports.forEach = forEach;\nexports.findElement = findElement;\nexports.removeElement = removeElement;\nexports.isFunction = isFunction;\nexports.isArray = isArray;\nexports.checkObjectHasKeys = checkObjectHasKeys;\nexports.checkObjectHasNoAdditionalKeys = checkObjectHasNoAdditionalKeys;\nexports.deepCopy = deepCopy;\nexports.deepCompare = deepCompare;\nexports.extend = extend;\nexports.runPolyfills = runPolyfills;\nexports.inherits = inherits;\nexports.polyfillSuper = polyfillSuper;\nexports.isNumber = isNumber;\nexports.removeHiddenChars = removeHiddenChars;\nexports.escapeRegExp = escapeRegExp;\nexports.globToRegexp = globToRegexp;\nexports.ensureNoTrailingSlash = ensureNoTrailingSlash;\nexports.sleep = sleep;\nexports.isNullOrUndefined = isNullOrUndefined;\nexports.defer = defer;\nexports.promiseMapSeries = promiseMapSeries;\nexports.promiseTry = promiseTry;\n\nvar _unhomoglyph = _interopRequireDefault(require(\"unhomoglyph\"));\n/*\nCopyright 2015, 2016 OpenMarket Ltd\nCopyright 2019 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * This is an internal module.\n * @module utils\n */\n\n/**\n * Encode a dictionary of query parameters.\n * @param {Object} params A dict of key/values to encode e.g.\n * {\"foo\": \"bar\", \"baz\": \"taz\"}\n * @return {string} The encoded string e.g. foo=bar&baz=taz\n */\n\n\nfunction encodeParams(params) {\n  let qs = \"\";\n\n  for (const key in params) {\n    if (!params.hasOwnProperty(key)) {\n      continue;\n    }\n\n    qs += \"&\" + encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]);\n  }\n\n  return qs.substring(1);\n}\n/**\n * Encodes a URI according to a set of template variables. Variables will be\n * passed through encodeURIComponent.\n * @param {string} pathTemplate The path with template variables e.g. '/foo/$bar'.\n * @param {Object} variables The key/value pairs to replace the template\n * variables with. E.g. { \"$bar\": \"baz\" }.\n * @return {string} The result of replacing all template variables e.g. '/foo/baz'.\n */\n\n\nfunction encodeUri(pathTemplate, variables) {\n  for (const key in variables) {\n    if (!variables.hasOwnProperty(key)) {\n      continue;\n    }\n\n    pathTemplate = pathTemplate.replace(key, encodeURIComponent(variables[key]));\n  }\n\n  return pathTemplate;\n}\n/**\n * Applies a map function to the given array.\n * @param {Array} array The array to apply the function to.\n * @param {Function} fn The function that will be invoked for each element in\n * the array with the signature <code>fn(element){...}</code>\n * @return {Array} A new array with the results of the function.\n */\n\n\nfunction map(array, fn) {\n  const results = new Array(array.length);\n\n  for (let i = 0; i < array.length; i++) {\n    results[i] = fn(array[i]);\n  }\n\n  return results;\n}\n/**\n * Applies a filter function to the given array.\n * @param {Array} array The array to apply the function to.\n * @param {Function} fn The function that will be invoked for each element in\n * the array. It should return true to keep the element. The function signature\n * looks like <code>fn(element, index, array){...}</code>.\n * @return {Array} A new array with the results of the function.\n */\n\n\nfunction filter(array, fn) {\n  const results = [];\n\n  for (let i = 0; i < array.length; i++) {\n    if (fn(array[i], i, array)) {\n      results.push(array[i]);\n    }\n  }\n\n  return results;\n}\n/**\n * Get the keys for an object. Same as <code>Object.keys()</code>.\n * @param {Object} obj The object to get the keys for.\n * @return {string[]} The keys of the object.\n */\n\n\nfunction keys(obj) {\n  const keys = [];\n\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    keys.push(key);\n  }\n\n  return keys;\n}\n/**\n * Get the values for an object.\n * @param {Object} obj The object to get the values for.\n * @return {Array<*>} The values of the object.\n */\n\n\nfunction values(obj) {\n  const values = [];\n\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    values.push(obj[key]);\n  }\n\n  return values;\n}\n/**\n * Invoke a function for each item in the array.\n * @param {Array} array The array.\n * @param {Function} fn The function to invoke for each element. Has the\n * function signature <code>fn(element, index)</code>.\n */\n\n\nfunction forEach(array, fn) {\n  for (let i = 0; i < array.length; i++) {\n    fn(array[i], i);\n  }\n}\n/**\n * The findElement() method returns a value in the array, if an element in the array\n * satisfies (returns true) the provided testing function. Otherwise undefined\n * is returned.\n * @param {Array} array The array.\n * @param {Function} fn Function to execute on each value in the array, with the\n * function signature <code>fn(element, index, array)</code>\n * @param {boolean} reverse True to search in reverse order.\n * @return {*} The first value in the array which returns <code>true</code> for\n * the given function.\n */\n\n\nfunction findElement(array, fn, reverse) {\n  let i;\n\n  if (reverse) {\n    for (i = array.length - 1; i >= 0; i--) {\n      if (fn(array[i], i, array)) {\n        return array[i];\n      }\n    }\n  } else {\n    for (i = 0; i < array.length; i++) {\n      if (fn(array[i], i, array)) {\n        return array[i];\n      }\n    }\n  }\n}\n/**\n * The removeElement() method removes the first element in the array that\n * satisfies (returns true) the provided testing function.\n * @param {Array} array The array.\n * @param {Function} fn Function to execute on each value in the array, with the\n * function signature <code>fn(element, index, array)</code>. Return true to\n * remove this element and break.\n * @param {boolean} reverse True to search in reverse order.\n * @return {boolean} True if an element was removed.\n */\n\n\nfunction removeElement(array, fn, reverse) {\n  let i;\n  let removed;\n\n  if (reverse) {\n    for (i = array.length - 1; i >= 0; i--) {\n      if (fn(array[i], i, array)) {\n        removed = array[i];\n        array.splice(i, 1);\n        return removed;\n      }\n    }\n  } else {\n    for (i = 0; i < array.length; i++) {\n      if (fn(array[i], i, array)) {\n        removed = array[i];\n        array.splice(i, 1);\n        return removed;\n      }\n    }\n  }\n\n  return false;\n}\n/**\n * Checks if the given thing is a function.\n * @param {*} value The thing to check.\n * @return {boolean} True if it is a function.\n */\n\n\nfunction isFunction(value) {\n  return Object.prototype.toString.call(value) == \"[object Function]\";\n}\n/**\n * Checks if the given thing is an array.\n * @param {*} value The thing to check.\n * @return {boolean} True if it is an array.\n */\n\n\nfunction isArray(value) {\n  return Array.isArray ? Array.isArray(value) : Boolean(value && value.constructor === Array);\n}\n/**\n * Checks that the given object has the specified keys.\n * @param {Object} obj The object to check.\n * @param {string[]} keys The list of keys that 'obj' must have.\n * @throws If the object is missing keys.\n */\n\n\nfunction checkObjectHasKeys(obj, keys) {\n  for (let i = 0; i < keys.length; i++) {\n    if (!obj.hasOwnProperty(keys[i])) {\n      throw new Error(\"Missing required key: \" + keys[i]);\n    }\n  }\n}\n/**\n * Checks that the given object has no extra keys other than the specified ones.\n * @param {Object} obj The object to check.\n * @param {string[]} allowedKeys The list of allowed key names.\n * @throws If there are extra keys.\n */\n\n\nfunction checkObjectHasNoAdditionalKeys(obj, allowedKeys) {\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    if (allowedKeys.indexOf(key) === -1) {\n      throw new Error(\"Unknown key: \" + key);\n    }\n  }\n}\n/**\n * Deep copy the given object. The object MUST NOT have circular references and\n * MUST NOT have functions.\n * @param {Object} obj The object to deep copy.\n * @return {Object} A copy of the object without any references to the original.\n */\n\n\nfunction deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n/**\n * Compare two objects for equality. The objects MUST NOT have circular references.\n *\n * @param {Object} x The first object to compare.\n * @param {Object} y The second object to compare.\n *\n * @return {boolean} true if the two objects are equal\n */\n\n\nfunction deepCompare(x, y) {\n  // Inspired by\n  // http://stackoverflow.com/questions/1068834/object-comparison-in-javascript#1144249\n  // Compare primitives and functions.\n  // Also check if both arguments link to the same object.\n  if (x === y) {\n    return true;\n  }\n\n  if (typeof x !== typeof y) {\n    return false;\n  } // special-case NaN (since NaN !== NaN)\n\n\n  if (typeof x === 'number' && isNaN(x) && isNaN(y)) {\n    return true;\n  } // special-case null (since typeof null == 'object', but null.constructor\n  // throws)\n\n\n  if (x === null || y === null) {\n    return x === y;\n  } // everything else is either an unequal primitive, or an object\n\n\n  if (!(x instanceof Object)) {\n    return false;\n  } // check they are the same type of object\n\n\n  if (x.constructor !== y.constructor || x.prototype !== y.prototype) {\n    return false;\n  } // special-casing for some special types of object\n\n\n  if (x instanceof RegExp || x instanceof Date) {\n    return x.toString() === y.toString();\n  } // the object algorithm works for Array, but it's sub-optimal.\n\n\n  if (x instanceof Array) {\n    if (x.length !== y.length) {\n      return false;\n    }\n\n    for (let i = 0; i < x.length; i++) {\n      if (!deepCompare(x[i], y[i])) {\n        return false;\n      }\n    }\n  } else {\n    // disable jshint \"The body of a for in should be wrapped in an if\n    // statement\"\n\n    /* jshint -W089 */\n    // check that all of y's direct keys are in x\n    let p;\n\n    for (p in y) {\n      if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n        return false;\n      }\n    } // finally, compare each of x's keys with y\n\n\n    for (p in y) {\n      // eslint-disable-line guard-for-in\n      if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n        return false;\n      }\n\n      if (!deepCompare(x[p], y[p])) {\n        return false;\n      }\n    }\n  }\n  /* jshint +W089 */\n\n\n  return true;\n}\n/**\n * Copy properties from one object to another.\n *\n * All enumerable properties, included inherited ones, are copied.\n *\n * This is approximately equivalent to ES6's Object.assign, except\n * that the latter doesn't copy inherited properties.\n *\n * @param {Object} target  The object that will receive new properties\n * @param {...Object} source  Objects from which to copy properties\n *\n * @return {Object} target\n */\n\n\nfunction extend() {\n  const target = arguments[0] || {};\n\n  for (let i = 1; i < arguments.length; i++) {\n    const source = arguments[i];\n\n    for (const propName in source) {\n      // eslint-disable-line guard-for-in\n      target[propName] = source[propName];\n    }\n  }\n\n  return target;\n}\n/**\n * Run polyfills to add Array.map and Array.filter if they are missing.\n */\n\n\nfunction runPolyfills() {\n  //                Array.prototype.filter\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\n  if (!Array.prototype.filter) {\n    Array.prototype.filter = function (fun\n    /*, thisArg*/\n    ) {\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n\n      const t = Object(this);\n      const len = t.length >>> 0;\n\n      if (typeof fun !== 'function') {\n        throw new TypeError();\n      }\n\n      const res = [];\n      const thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n\n      for (let i = 0; i < len; i++) {\n        if (i in t) {\n          const val = t[i]; // NOTE: Technically this should Object.defineProperty at\n          //       the next index, as push can be affected by\n          //       properties on Object.prototype and Array.prototype.\n          //       But that method's new, and collisions should be\n          //       rare, so use the more-compatible alternative.\n\n          if (fun.call(thisArg, val, i, t)) {\n            res.push(val);\n          }\n        }\n      }\n\n      return res;\n    };\n  } //                Array.prototype.map\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\n  // Production steps of ECMA-262, Edition 5, 15.4.4.19\n  // Reference: http://es5.github.io/#x15.4.4.19\n\n\n  if (!Array.prototype.map) {\n    Array.prototype.map = function (callback, thisArg) {\n      let T, k;\n\n      if (this === null || this === undefined) {\n        throw new TypeError(' this is null or not defined');\n      } // 1. Let O be the result of calling ToObject passing the |this|\n      //    value as the argument.\n\n\n      const O = Object(this); // 2. Let lenValue be the result of calling the Get internal\n      //    method of O with the argument \"length\".\n      // 3. Let len be ToUint32(lenValue).\n\n      const len = O.length >>> 0; // 4. If IsCallable(callback) is false, throw a TypeError exception.\n      // See: http://es5.github.com/#x9.11\n\n      if (typeof callback !== 'function') {\n        throw new TypeError(callback + ' is not a function');\n      } // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      } // 6. Let A be a new array created as if by the expression new Array(len)\n      //    where Array is the standard built-in constructor with that name and\n      //    len is the value of len.\n\n\n      const A = new Array(len); // 7. Let k be 0\n\n      k = 0; // 8. Repeat, while k < len\n\n      while (k < len) {\n        var kValue, mappedValue; // a. Let Pk be ToString(k).\n        //   This is implicit for LHS operands of the in operator\n        // b. Let kPresent be the result of calling the HasProperty internal\n        //    method of O with argument Pk.\n        //   This step can be combined with c\n        // c. If kPresent is true, then\n\n        if (k in O) {\n          // i. Let kValue be the result of calling the Get internal\n          //    method of O with argument Pk.\n          kValue = O[k]; // ii. Let mappedValue be the result of calling the Call internal\n          //     method of callback with T as the this value and argument\n          //     list containing kValue, k, and O.\n\n          mappedValue = callback.call(T, kValue, k, O); // iii. Call the DefineOwnProperty internal method of A with arguments\n          // Pk, Property Descriptor\n          // { Value: mappedValue,\n          //   Writable: true,\n          //   Enumerable: true,\n          //   Configurable: true },\n          // and false.\n          // In browsers that support Object.defineProperty, use the following:\n          // Object.defineProperty(A, k, {\n          //   value: mappedValue,\n          //   writable: true,\n          //   enumerable: true,\n          //   configurable: true\n          // });\n          // For best browser support, use the following:\n\n          A[k] = mappedValue;\n        } // d. Increase k by 1.\n\n\n        k++;\n      } // 9. return A\n\n\n      return A;\n    };\n  } //                Array.prototype.forEach\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\n  // Production steps of ECMA-262, Edition 5, 15.4.4.18\n  // Reference: http://es5.github.io/#x15.4.4.18\n\n\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function (callback, thisArg) {\n      let T, k;\n\n      if (this === null || this === undefined) {\n        throw new TypeError(' this is null or not defined');\n      } // 1. Let O be the result of calling ToObject passing the |this| value as the\n      // argument.\n\n\n      const O = Object(this); // 2. Let lenValue be the result of calling the Get internal method of O with the\n      // argument \"length\".\n      // 3. Let len be ToUint32(lenValue).\n\n      const len = O.length >>> 0; // 4. If IsCallable(callback) is false, throw a TypeError exception.\n      // See: http://es5.github.com/#x9.11\n\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + ' is not a function');\n      } // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      } // 6. Let k be 0\n\n\n      k = 0; // 7. Repeat, while k < len\n\n      while (k < len) {\n        var kValue; // a. Let Pk be ToString(k).\n        //   This is implicit for LHS operands of the in operator\n        // b. Let kPresent be the result of calling the HasProperty internal\n        //    method of O with\n        //    argument Pk.\n        //   This step can be combined with c\n        // c. If kPresent is true, then\n\n        if (k in O) {\n          // i. Let kValue be the result of calling the Get internal method of O with\n          // argument Pk\n          kValue = O[k]; // ii. Call the Call internal method of callback with T as the this value and\n          // argument list containing kValue, k, and O.\n\n          callback.call(T, kValue, k, O);\n        } // d. Increase k by 1.\n\n\n        k++;\n      } // 8. return undefined\n\n    };\n  }\n}\n/**\n * Inherit the prototype methods from one constructor into another. This is a\n * port of the Node.js implementation with an Object.create polyfill.\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\n\n\nfunction inherits(ctor, superCtor) {\n  // Add util.inherits from Node.js\n  // Source:\n  // https://github.com/joyent/node/blob/master/lib/util.js\n  // Copyright Joyent, Inc. and other Node contributors.\n  //\n  // Permission is hereby granted, free of charge, to any person obtaining a\n  // copy of this software and associated documentation files (the\n  // \"Software\"), to deal in the Software without restriction, including\n  // without limitation the rights to use, copy, modify, merge, publish,\n  // distribute, sublicense, and/or sell copies of the Software, and to permit\n  // persons to whom the Software is furnished to do so, subject to the\n  // following conditions:\n  //\n  // The above copyright notice and this permission notice shall be included\n  // in all copies or substantial portions of the Software.\n  //\n  // THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  // OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n  // MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n  // NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n  // DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n  // OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n  // USE OR OTHER DEALINGS IN THE SOFTWARE.\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n/**\n * Polyfills inheritance for prototypes by allowing different kinds of\n * super types. Typically prototypes would use `SuperType.call(this, params)`\n * though this doesn't always work in some environments - this function\n * falls back to using `Object.assign()` to clone a constructed copy\n * of the super type onto `thisArg`.\n * @param {any} thisArg The child instance. Modified in place.\n * @param {any} SuperType The type to act as a super instance\n * @param {any} params Arguments to supply to the super type's constructor\n */\n\n\nfunction polyfillSuper(thisArg, SuperType, ...params) {\n  try {\n    SuperType.call(thisArg, ...params);\n  } catch (e) {\n    // fall back to Object.assign to just clone the thing\n    const fakeSuper = new SuperType(...params);\n    Object.assign(thisArg, fakeSuper);\n  }\n}\n/**\n * Returns whether the given value is a finite number without type-coercion\n *\n * @param {*} value the value to test\n * @return {boolean} whether or not value is a finite number without type-coercion\n */\n\n\nfunction isNumber(value) {\n  return typeof value === 'number' && isFinite(value);\n}\n/**\n * Removes zero width chars, diacritics and whitespace from the string\n * Also applies an unhomoglyph on the string, to prevent similar looking chars\n * @param {string} str the string to remove hidden characters from\n * @return {string} a string with the hidden characters removed\n */\n\n\nfunction removeHiddenChars(str) {\n  return (0, _unhomoglyph.default)(str.normalize('NFD').replace(removeHiddenCharsRegex, ''));\n} // Regex matching bunch of unicode control characters and otherwise misleading/invisible characters.\n// Includes:\n// various width spaces U+2000 - U+200D\n// LTR and RTL marks U+200E and U+200F\n// LTR/RTL and other directional formatting marks U+202A - U+202F\n// Combining characters U+0300 - U+036F\n// Zero width no-break space (BOM) U+FEFF\n\n\nconst removeHiddenCharsRegex = /[\\u2000-\\u200F\\u202A-\\u202F\\u0300-\\u036f\\uFEFF\\s]/g;\n\nfunction escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\nfunction globToRegexp(glob, extended) {\n  extended = typeof extended === 'boolean' ? extended : true; // From\n  // https://github.com/matrix-org/synapse/blob/abbee6b29be80a77e05730707602f3bbfc3f38cb/synapse/push/__init__.py#L132\n  // Because micromatch is about 130KB with dependencies,\n  // and minimatch is not much better.\n\n  let pat = escapeRegExp(glob);\n  pat = pat.replace(/\\\\\\*/g, '.*');\n  pat = pat.replace(/\\?/g, '.');\n\n  if (extended) {\n    pat = pat.replace(/\\\\\\[(!|)(.*)\\\\]/g, function (match, p1, p2, offset, string) {\n      const first = p1 && '^' || '';\n      const second = p2.replace(/\\\\-/, '-');\n      return '[' + first + second + ']';\n    });\n  }\n\n  return pat;\n}\n\nfunction ensureNoTrailingSlash(url) {\n  if (url && url.endsWith(\"/\")) {\n    return url.substr(0, url.length - 1);\n  } else {\n    return url;\n  }\n} // Returns a promise which resolves with a given value after the given number of ms\n\n\nfunction sleep(ms, value) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms, value);\n  });\n}\n\nfunction isNullOrUndefined(val) {\n  return val === null || val === undefined;\n} // Returns a Deferred\n\n\nfunction defer() {\n  let resolve;\n  let reject;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  return {\n    resolve,\n    reject,\n    promise\n  };\n}\n\nasync function promiseMapSeries(promises, fn) {\n  for (const o of await promises) {\n    await fn((await o));\n  }\n}\n\nfunction promiseTry(fn) {\n  return new Promise(resolve => resolve(fn()));\n}","map":{"version":3,"sources":["/home/kimist/Developpement/React/watcha_client/node_modules/matrix-js-sdk/lib/utils.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","encodeParams","encodeUri","map","filter","keys","values","forEach","findElement","removeElement","isFunction","isArray","checkObjectHasKeys","checkObjectHasNoAdditionalKeys","deepCopy","deepCompare","extend","runPolyfills","inherits","polyfillSuper","isNumber","removeHiddenChars","escapeRegExp","globToRegexp","ensureNoTrailingSlash","sleep","isNullOrUndefined","defer","promiseMapSeries","promiseTry","_unhomoglyph","params","qs","key","hasOwnProperty","encodeURIComponent","substring","pathTemplate","variables","replace","array","fn","results","Array","length","i","push","obj","reverse","removed","splice","prototype","toString","call","Boolean","constructor","Error","allowedKeys","indexOf","JSON","parse","stringify","x","y","isNaN","RegExp","Date","p","target","arguments","source","propName","fun","TypeError","t","len","res","thisArg","val","callback","T","k","undefined","O","A","kValue","mappedValue","ctor","superCtor","super_","create","enumerable","writable","configurable","SuperType","e","fakeSuper","assign","isFinite","str","default","normalize","removeHiddenCharsRegex","string","glob","extended","pat","match","p1","p2","offset","first","second","url","endsWith","substr","ms","Promise","resolve","setTimeout","reject","promise","_resolve","_reject","promises","o"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.encodeParams = encodeParams;\nexports.encodeUri = encodeUri;\nexports.map = map;\nexports.filter = filter;\nexports.keys = keys;\nexports.values = values;\nexports.forEach = forEach;\nexports.findElement = findElement;\nexports.removeElement = removeElement;\nexports.isFunction = isFunction;\nexports.isArray = isArray;\nexports.checkObjectHasKeys = checkObjectHasKeys;\nexports.checkObjectHasNoAdditionalKeys = checkObjectHasNoAdditionalKeys;\nexports.deepCopy = deepCopy;\nexports.deepCompare = deepCompare;\nexports.extend = extend;\nexports.runPolyfills = runPolyfills;\nexports.inherits = inherits;\nexports.polyfillSuper = polyfillSuper;\nexports.isNumber = isNumber;\nexports.removeHiddenChars = removeHiddenChars;\nexports.escapeRegExp = escapeRegExp;\nexports.globToRegexp = globToRegexp;\nexports.ensureNoTrailingSlash = ensureNoTrailingSlash;\nexports.sleep = sleep;\nexports.isNullOrUndefined = isNullOrUndefined;\nexports.defer = defer;\nexports.promiseMapSeries = promiseMapSeries;\nexports.promiseTry = promiseTry;\n\nvar _unhomoglyph = _interopRequireDefault(require(\"unhomoglyph\"));\n\n/*\nCopyright 2015, 2016 OpenMarket Ltd\nCopyright 2019 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * This is an internal module.\n * @module utils\n */\n\n/**\n * Encode a dictionary of query parameters.\n * @param {Object} params A dict of key/values to encode e.g.\n * {\"foo\": \"bar\", \"baz\": \"taz\"}\n * @return {string} The encoded string e.g. foo=bar&baz=taz\n */\nfunction encodeParams(params) {\n  let qs = \"\";\n\n  for (const key in params) {\n    if (!params.hasOwnProperty(key)) {\n      continue;\n    }\n\n    qs += \"&\" + encodeURIComponent(key) + \"=\" + encodeURIComponent(params[key]);\n  }\n\n  return qs.substring(1);\n}\n/**\n * Encodes a URI according to a set of template variables. Variables will be\n * passed through encodeURIComponent.\n * @param {string} pathTemplate The path with template variables e.g. '/foo/$bar'.\n * @param {Object} variables The key/value pairs to replace the template\n * variables with. E.g. { \"$bar\": \"baz\" }.\n * @return {string} The result of replacing all template variables e.g. '/foo/baz'.\n */\n\n\nfunction encodeUri(pathTemplate, variables) {\n  for (const key in variables) {\n    if (!variables.hasOwnProperty(key)) {\n      continue;\n    }\n\n    pathTemplate = pathTemplate.replace(key, encodeURIComponent(variables[key]));\n  }\n\n  return pathTemplate;\n}\n/**\n * Applies a map function to the given array.\n * @param {Array} array The array to apply the function to.\n * @param {Function} fn The function that will be invoked for each element in\n * the array with the signature <code>fn(element){...}</code>\n * @return {Array} A new array with the results of the function.\n */\n\n\nfunction map(array, fn) {\n  const results = new Array(array.length);\n\n  for (let i = 0; i < array.length; i++) {\n    results[i] = fn(array[i]);\n  }\n\n  return results;\n}\n/**\n * Applies a filter function to the given array.\n * @param {Array} array The array to apply the function to.\n * @param {Function} fn The function that will be invoked for each element in\n * the array. It should return true to keep the element. The function signature\n * looks like <code>fn(element, index, array){...}</code>.\n * @return {Array} A new array with the results of the function.\n */\n\n\nfunction filter(array, fn) {\n  const results = [];\n\n  for (let i = 0; i < array.length; i++) {\n    if (fn(array[i], i, array)) {\n      results.push(array[i]);\n    }\n  }\n\n  return results;\n}\n/**\n * Get the keys for an object. Same as <code>Object.keys()</code>.\n * @param {Object} obj The object to get the keys for.\n * @return {string[]} The keys of the object.\n */\n\n\nfunction keys(obj) {\n  const keys = [];\n\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    keys.push(key);\n  }\n\n  return keys;\n}\n/**\n * Get the values for an object.\n * @param {Object} obj The object to get the values for.\n * @return {Array<*>} The values of the object.\n */\n\n\nfunction values(obj) {\n  const values = [];\n\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    values.push(obj[key]);\n  }\n\n  return values;\n}\n/**\n * Invoke a function for each item in the array.\n * @param {Array} array The array.\n * @param {Function} fn The function to invoke for each element. Has the\n * function signature <code>fn(element, index)</code>.\n */\n\n\nfunction forEach(array, fn) {\n  for (let i = 0; i < array.length; i++) {\n    fn(array[i], i);\n  }\n}\n/**\n * The findElement() method returns a value in the array, if an element in the array\n * satisfies (returns true) the provided testing function. Otherwise undefined\n * is returned.\n * @param {Array} array The array.\n * @param {Function} fn Function to execute on each value in the array, with the\n * function signature <code>fn(element, index, array)</code>\n * @param {boolean} reverse True to search in reverse order.\n * @return {*} The first value in the array which returns <code>true</code> for\n * the given function.\n */\n\n\nfunction findElement(array, fn, reverse) {\n  let i;\n\n  if (reverse) {\n    for (i = array.length - 1; i >= 0; i--) {\n      if (fn(array[i], i, array)) {\n        return array[i];\n      }\n    }\n  } else {\n    for (i = 0; i < array.length; i++) {\n      if (fn(array[i], i, array)) {\n        return array[i];\n      }\n    }\n  }\n}\n/**\n * The removeElement() method removes the first element in the array that\n * satisfies (returns true) the provided testing function.\n * @param {Array} array The array.\n * @param {Function} fn Function to execute on each value in the array, with the\n * function signature <code>fn(element, index, array)</code>. Return true to\n * remove this element and break.\n * @param {boolean} reverse True to search in reverse order.\n * @return {boolean} True if an element was removed.\n */\n\n\nfunction removeElement(array, fn, reverse) {\n  let i;\n  let removed;\n\n  if (reverse) {\n    for (i = array.length - 1; i >= 0; i--) {\n      if (fn(array[i], i, array)) {\n        removed = array[i];\n        array.splice(i, 1);\n        return removed;\n      }\n    }\n  } else {\n    for (i = 0; i < array.length; i++) {\n      if (fn(array[i], i, array)) {\n        removed = array[i];\n        array.splice(i, 1);\n        return removed;\n      }\n    }\n  }\n\n  return false;\n}\n/**\n * Checks if the given thing is a function.\n * @param {*} value The thing to check.\n * @return {boolean} True if it is a function.\n */\n\n\nfunction isFunction(value) {\n  return Object.prototype.toString.call(value) == \"[object Function]\";\n}\n/**\n * Checks if the given thing is an array.\n * @param {*} value The thing to check.\n * @return {boolean} True if it is an array.\n */\n\n\nfunction isArray(value) {\n  return Array.isArray ? Array.isArray(value) : Boolean(value && value.constructor === Array);\n}\n/**\n * Checks that the given object has the specified keys.\n * @param {Object} obj The object to check.\n * @param {string[]} keys The list of keys that 'obj' must have.\n * @throws If the object is missing keys.\n */\n\n\nfunction checkObjectHasKeys(obj, keys) {\n  for (let i = 0; i < keys.length; i++) {\n    if (!obj.hasOwnProperty(keys[i])) {\n      throw new Error(\"Missing required key: \" + keys[i]);\n    }\n  }\n}\n/**\n * Checks that the given object has no extra keys other than the specified ones.\n * @param {Object} obj The object to check.\n * @param {string[]} allowedKeys The list of allowed key names.\n * @throws If there are extra keys.\n */\n\n\nfunction checkObjectHasNoAdditionalKeys(obj, allowedKeys) {\n  for (const key in obj) {\n    if (!obj.hasOwnProperty(key)) {\n      continue;\n    }\n\n    if (allowedKeys.indexOf(key) === -1) {\n      throw new Error(\"Unknown key: \" + key);\n    }\n  }\n}\n/**\n * Deep copy the given object. The object MUST NOT have circular references and\n * MUST NOT have functions.\n * @param {Object} obj The object to deep copy.\n * @return {Object} A copy of the object without any references to the original.\n */\n\n\nfunction deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n/**\n * Compare two objects for equality. The objects MUST NOT have circular references.\n *\n * @param {Object} x The first object to compare.\n * @param {Object} y The second object to compare.\n *\n * @return {boolean} true if the two objects are equal\n */\n\n\nfunction deepCompare(x, y) {\n  // Inspired by\n  // http://stackoverflow.com/questions/1068834/object-comparison-in-javascript#1144249\n  // Compare primitives and functions.\n  // Also check if both arguments link to the same object.\n  if (x === y) {\n    return true;\n  }\n\n  if (typeof x !== typeof y) {\n    return false;\n  } // special-case NaN (since NaN !== NaN)\n\n\n  if (typeof x === 'number' && isNaN(x) && isNaN(y)) {\n    return true;\n  } // special-case null (since typeof null == 'object', but null.constructor\n  // throws)\n\n\n  if (x === null || y === null) {\n    return x === y;\n  } // everything else is either an unequal primitive, or an object\n\n\n  if (!(x instanceof Object)) {\n    return false;\n  } // check they are the same type of object\n\n\n  if (x.constructor !== y.constructor || x.prototype !== y.prototype) {\n    return false;\n  } // special-casing for some special types of object\n\n\n  if (x instanceof RegExp || x instanceof Date) {\n    return x.toString() === y.toString();\n  } // the object algorithm works for Array, but it's sub-optimal.\n\n\n  if (x instanceof Array) {\n    if (x.length !== y.length) {\n      return false;\n    }\n\n    for (let i = 0; i < x.length; i++) {\n      if (!deepCompare(x[i], y[i])) {\n        return false;\n      }\n    }\n  } else {\n    // disable jshint \"The body of a for in should be wrapped in an if\n    // statement\"\n\n    /* jshint -W089 */\n    // check that all of y's direct keys are in x\n    let p;\n\n    for (p in y) {\n      if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n        return false;\n      }\n    } // finally, compare each of x's keys with y\n\n\n    for (p in y) {\n      // eslint-disable-line guard-for-in\n      if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n        return false;\n      }\n\n      if (!deepCompare(x[p], y[p])) {\n        return false;\n      }\n    }\n  }\n  /* jshint +W089 */\n\n\n  return true;\n}\n/**\n * Copy properties from one object to another.\n *\n * All enumerable properties, included inherited ones, are copied.\n *\n * This is approximately equivalent to ES6's Object.assign, except\n * that the latter doesn't copy inherited properties.\n *\n * @param {Object} target  The object that will receive new properties\n * @param {...Object} source  Objects from which to copy properties\n *\n * @return {Object} target\n */\n\n\nfunction extend() {\n  const target = arguments[0] || {};\n\n  for (let i = 1; i < arguments.length; i++) {\n    const source = arguments[i];\n\n    for (const propName in source) {\n      // eslint-disable-line guard-for-in\n      target[propName] = source[propName];\n    }\n  }\n\n  return target;\n}\n/**\n * Run polyfills to add Array.map and Array.filter if they are missing.\n */\n\n\nfunction runPolyfills() {\n  //                Array.prototype.filter\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\n  if (!Array.prototype.filter) {\n    Array.prototype.filter = function (fun\n    /*, thisArg*/\n    ) {\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n\n      const t = Object(this);\n      const len = t.length >>> 0;\n\n      if (typeof fun !== 'function') {\n        throw new TypeError();\n      }\n\n      const res = [];\n      const thisArg = arguments.length >= 2 ? arguments[1] : void 0;\n\n      for (let i = 0; i < len; i++) {\n        if (i in t) {\n          const val = t[i]; // NOTE: Technically this should Object.defineProperty at\n          //       the next index, as push can be affected by\n          //       properties on Object.prototype and Array.prototype.\n          //       But that method's new, and collisions should be\n          //       rare, so use the more-compatible alternative.\n\n          if (fun.call(thisArg, val, i, t)) {\n            res.push(val);\n          }\n        }\n      }\n\n      return res;\n    };\n  } //                Array.prototype.map\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map\n  // Production steps of ECMA-262, Edition 5, 15.4.4.19\n  // Reference: http://es5.github.io/#x15.4.4.19\n\n\n  if (!Array.prototype.map) {\n    Array.prototype.map = function (callback, thisArg) {\n      let T, k;\n\n      if (this === null || this === undefined) {\n        throw new TypeError(' this is null or not defined');\n      } // 1. Let O be the result of calling ToObject passing the |this|\n      //    value as the argument.\n\n\n      const O = Object(this); // 2. Let lenValue be the result of calling the Get internal\n      //    method of O with the argument \"length\".\n      // 3. Let len be ToUint32(lenValue).\n\n      const len = O.length >>> 0; // 4. If IsCallable(callback) is false, throw a TypeError exception.\n      // See: http://es5.github.com/#x9.11\n\n      if (typeof callback !== 'function') {\n        throw new TypeError(callback + ' is not a function');\n      } // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      } // 6. Let A be a new array created as if by the expression new Array(len)\n      //    where Array is the standard built-in constructor with that name and\n      //    len is the value of len.\n\n\n      const A = new Array(len); // 7. Let k be 0\n\n      k = 0; // 8. Repeat, while k < len\n\n      while (k < len) {\n        var kValue, mappedValue; // a. Let Pk be ToString(k).\n        //   This is implicit for LHS operands of the in operator\n        // b. Let kPresent be the result of calling the HasProperty internal\n        //    method of O with argument Pk.\n        //   This step can be combined with c\n        // c. If kPresent is true, then\n\n        if (k in O) {\n          // i. Let kValue be the result of calling the Get internal\n          //    method of O with argument Pk.\n          kValue = O[k]; // ii. Let mappedValue be the result of calling the Call internal\n          //     method of callback with T as the this value and argument\n          //     list containing kValue, k, and O.\n\n          mappedValue = callback.call(T, kValue, k, O); // iii. Call the DefineOwnProperty internal method of A with arguments\n          // Pk, Property Descriptor\n          // { Value: mappedValue,\n          //   Writable: true,\n          //   Enumerable: true,\n          //   Configurable: true },\n          // and false.\n          // In browsers that support Object.defineProperty, use the following:\n          // Object.defineProperty(A, k, {\n          //   value: mappedValue,\n          //   writable: true,\n          //   enumerable: true,\n          //   configurable: true\n          // });\n          // For best browser support, use the following:\n\n          A[k] = mappedValue;\n        } // d. Increase k by 1.\n\n\n        k++;\n      } // 9. return A\n\n\n      return A;\n    };\n  } //                Array.prototype.forEach\n  // ========================================================\n  // SOURCE:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach\n  // Production steps of ECMA-262, Edition 5, 15.4.4.18\n  // Reference: http://es5.github.io/#x15.4.4.18\n\n\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function (callback, thisArg) {\n      let T, k;\n\n      if (this === null || this === undefined) {\n        throw new TypeError(' this is null or not defined');\n      } // 1. Let O be the result of calling ToObject passing the |this| value as the\n      // argument.\n\n\n      const O = Object(this); // 2. Let lenValue be the result of calling the Get internal method of O with the\n      // argument \"length\".\n      // 3. Let len be ToUint32(lenValue).\n\n      const len = O.length >>> 0; // 4. If IsCallable(callback) is false, throw a TypeError exception.\n      // See: http://es5.github.com/#x9.11\n\n      if (typeof callback !== \"function\") {\n        throw new TypeError(callback + ' is not a function');\n      } // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n\n\n      if (arguments.length > 1) {\n        T = thisArg;\n      } // 6. Let k be 0\n\n\n      k = 0; // 7. Repeat, while k < len\n\n      while (k < len) {\n        var kValue; // a. Let Pk be ToString(k).\n        //   This is implicit for LHS operands of the in operator\n        // b. Let kPresent be the result of calling the HasProperty internal\n        //    method of O with\n        //    argument Pk.\n        //   This step can be combined with c\n        // c. If kPresent is true, then\n\n        if (k in O) {\n          // i. Let kValue be the result of calling the Get internal method of O with\n          // argument Pk\n          kValue = O[k]; // ii. Call the Call internal method of callback with T as the this value and\n          // argument list containing kValue, k, and O.\n\n          callback.call(T, kValue, k, O);\n        } // d. Increase k by 1.\n\n\n        k++;\n      } // 8. return undefined\n\n    };\n  }\n}\n/**\n * Inherit the prototype methods from one constructor into another. This is a\n * port of the Node.js implementation with an Object.create polyfill.\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\n\n\nfunction inherits(ctor, superCtor) {\n  // Add util.inherits from Node.js\n  // Source:\n  // https://github.com/joyent/node/blob/master/lib/util.js\n  // Copyright Joyent, Inc. and other Node contributors.\n  //\n  // Permission is hereby granted, free of charge, to any person obtaining a\n  // copy of this software and associated documentation files (the\n  // \"Software\"), to deal in the Software without restriction, including\n  // without limitation the rights to use, copy, modify, merge, publish,\n  // distribute, sublicense, and/or sell copies of the Software, and to permit\n  // persons to whom the Software is furnished to do so, subject to the\n  // following conditions:\n  //\n  // The above copyright notice and this permission notice shall be included\n  // in all copies or substantial portions of the Software.\n  //\n  // THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  // OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n  // MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n  // NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n  // DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n  // OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n  // USE OR OTHER DEALINGS IN THE SOFTWARE.\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n/**\n * Polyfills inheritance for prototypes by allowing different kinds of\n * super types. Typically prototypes would use `SuperType.call(this, params)`\n * though this doesn't always work in some environments - this function\n * falls back to using `Object.assign()` to clone a constructed copy\n * of the super type onto `thisArg`.\n * @param {any} thisArg The child instance. Modified in place.\n * @param {any} SuperType The type to act as a super instance\n * @param {any} params Arguments to supply to the super type's constructor\n */\n\n\nfunction polyfillSuper(thisArg, SuperType, ...params) {\n  try {\n    SuperType.call(thisArg, ...params);\n  } catch (e) {\n    // fall back to Object.assign to just clone the thing\n    const fakeSuper = new SuperType(...params);\n    Object.assign(thisArg, fakeSuper);\n  }\n}\n/**\n * Returns whether the given value is a finite number without type-coercion\n *\n * @param {*} value the value to test\n * @return {boolean} whether or not value is a finite number without type-coercion\n */\n\n\nfunction isNumber(value) {\n  return typeof value === 'number' && isFinite(value);\n}\n/**\n * Removes zero width chars, diacritics and whitespace from the string\n * Also applies an unhomoglyph on the string, to prevent similar looking chars\n * @param {string} str the string to remove hidden characters from\n * @return {string} a string with the hidden characters removed\n */\n\n\nfunction removeHiddenChars(str) {\n  return (0, _unhomoglyph.default)(str.normalize('NFD').replace(removeHiddenCharsRegex, ''));\n} // Regex matching bunch of unicode control characters and otherwise misleading/invisible characters.\n// Includes:\n// various width spaces U+2000 - U+200D\n// LTR and RTL marks U+200E and U+200F\n// LTR/RTL and other directional formatting marks U+202A - U+202F\n// Combining characters U+0300 - U+036F\n// Zero width no-break space (BOM) U+FEFF\n\n\nconst removeHiddenCharsRegex = /[\\u2000-\\u200F\\u202A-\\u202F\\u0300-\\u036f\\uFEFF\\s]/g;\n\nfunction escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\nfunction globToRegexp(glob, extended) {\n  extended = typeof extended === 'boolean' ? extended : true; // From\n  // https://github.com/matrix-org/synapse/blob/abbee6b29be80a77e05730707602f3bbfc3f38cb/synapse/push/__init__.py#L132\n  // Because micromatch is about 130KB with dependencies,\n  // and minimatch is not much better.\n\n  let pat = escapeRegExp(glob);\n  pat = pat.replace(/\\\\\\*/g, '.*');\n  pat = pat.replace(/\\?/g, '.');\n\n  if (extended) {\n    pat = pat.replace(/\\\\\\[(!|)(.*)\\\\]/g, function (match, p1, p2, offset, string) {\n      const first = p1 && '^' || '';\n      const second = p2.replace(/\\\\-/, '-');\n      return '[' + first + second + ']';\n    });\n  }\n\n  return pat;\n}\n\nfunction ensureNoTrailingSlash(url) {\n  if (url && url.endsWith(\"/\")) {\n    return url.substr(0, url.length - 1);\n  } else {\n    return url;\n  }\n} // Returns a promise which resolves with a given value after the given number of ms\n\n\nfunction sleep(ms, value) {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms, value);\n  });\n}\n\nfunction isNullOrUndefined(val) {\n  return val === null || val === undefined;\n} // Returns a Deferred\n\n\nfunction defer() {\n  let resolve;\n  let reject;\n  const promise = new Promise((_resolve, _reject) => {\n    resolve = _resolve;\n    reject = _reject;\n  });\n  return {\n    resolve,\n    reject,\n    promise\n  };\n}\n\nasync function promiseMapSeries(promises, fn) {\n  for (const o of await promises) {\n    await fn((await o));\n  }\n}\n\nfunction promiseTry(fn) {\n  return new Promise(resolve => resolve(fn()));\n}"]},"metadata":{},"sourceType":"script"}